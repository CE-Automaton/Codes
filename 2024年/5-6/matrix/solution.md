首先考虑只有 `01` 怎么做，实际上就行和列分别进行一个可重排列即可。对应的方案是唯一的（由于 **杨图的性质**），比如说：

```
   3  2  1  1
2  x  x  x  x
1  x  x
4  x
```

以行为例，选择最大的行，此时一定有恰好它这么多列非零：

```
    1  2  3  1
 2  
 1 
 4  x  x  x  x
```

然后再选择最大的行：

```
    0  1  2  0
 2     x  x  
 1 
 4  x  x  x  x
```

我们考虑依次在 $0$ 里面选出一些 $1$，$1$ 里面选出一些 $2$，……方案数相乘即可。

比如 $1$ 长这样，我们要从中选出一些 $2$：

```
  1  1  1  1
  1  1
  1
```

假如每列有 $a_i$ 个 $2$，每行有 $b_i$ 个 $2$，那么我们就是要找到 $a,b$ 的一个置换，使得：根据杨图的构造方式，不会有 $0$ 被改成 $2$。比如上述情况的第四列，若 $a_4=1$，结果 $b_3=3$，那么 $(3,4)$ 就会被弄成 $2$，这是不可接受的。

设 $p_j$ 为 第 $j$ 多的列，那么最后它等于 $0$ 的行的 $b_i<j$。我们从右向左填 $a$，设 $f_{i,j}$ 表示从右向左到了第 $i$ 列，最小值为 $j$ 的方案数，计算 $b$ 的填法的方案数就是“排列 $p_i$ 的数量使得 $p_i<Hold_i$ 这样的问题”，$∏(a_i−i+1)$ 即可。而这个 $∏$ 可以很轻松地分阶段，就可以 dp 了。