# 动态维护直径总结

~~直接做肯定可以 **LCT**，这里仅考虑不用 **LCT** 的方法~~

> 结论：设两个树上连通点集 $S$、$T$ 的直径端点分别为 $(s_1,s_2)$、$(t_1,t_2)$，那么点集 $S\cup T$ 的直径端点也一定在这四个点内。

## 法 1

直接用线段树维护全 dfs 序（欧拉序）每个区间的直径端点，区间 $merge$​ 合并端点，或者说，每个区间维护一个深度最小的点（LCA）、一个深度最大的点、左/右边点走到 LCA 的最大路径以及最长路径，区间合并略

该方法可支持修改边权（每次修改相当于修改了一个区间的点的 dep，直接改就行了），树形态不可改变，森林情况可以维护多个线段树，不支持删边

## 法 2

用数据结构维护每个点的 dep，再维护个 LCA，离线建树合并树的时候直接合并直径端点，要么把直径存在根节点上，要么用并查集，边时间为 L~R 的时候因为不好删除，直接线段树分治做就行了

该方法可支持修改边权、所有边仅能组成森林情况下的加边减边

## 法 3

~~LCT 大法好！~~