## 整体二分

在信息学竞赛中，有一部分题目可以使用二分的办法来解决。但是当这种题目有多次询问且我们每次查询都直接二分可能导致 TLE 时，就会用到整体二分。整体二分的主体思路就是把多个查询一起解决。（所以这是一个离线算法）

> 可以使用整体二分解决的题目需要满足以下性质：
>
> 1. 询问的答案具有可二分性
>
> 2. **修改对判定答案的贡献互相独立**，修改之间互不影响效果
>
> 3. 修改如果对判定答案有贡献，则贡献为一确定的与判定标准无关的值
>
> 4. 贡献满足交换律，结合律，具有可加性
>
> 5. 题目允许使用离线算法
>
>    ——许昊然《浅谈数据结构题几个非经典解法》

记 $[l,r]$ 为答案的值域，$[L,R]$ 为答案的定义域。（也就是说求答案时仅考虑下标在区间 $[L,R]$ 内的操作和询问，这其中询问的答案在 $[l,r]$ 内)

- 我们首先把所有操作 **按时间顺序** 存入数组中，然后开始分治。
- 在每一层分治中，利用数据结构（常见的是树状数组）统计当前查询的答案和 $mid$ 之间的关系。
- 根据查询出来的答案和 $mid$ 间的关系（小于等于 $mid$ 和大于 $mid$）将当前处理的操作序列分为 $q1$ 和 $q2$ 两份，并分别递归处理。
- 当 $l=r$ 时，找到答案，记录答案并返回即可。

需要注意的是，在整体二分过程中，若当前处理的值域为 $[l,r]$，则此时最终答案范围不在 $[l,r]$ 的询问会在其他时候处理。

时间复杂度：由于二分层数为 $log$，每个询问只会访问 $log$ 层，所以不考虑 check 答案的时间复杂度的情况下，整体二分的时间复杂度为 $n\ log\ m$（$n$ 为询问个数，$m$ 为二分的值域），而整体二分的关键在于 check 所需的时间复杂度，因为 check $mid$ 时需维护 $1\sim mid$ 的操作结果，用上整体二分时每个操作累计加减次数不高，因此能过（自己的观点，应该是对的吧）